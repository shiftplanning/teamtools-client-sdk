function ajaxWrapper(url,callback){var xhr=null;this.log=function(text){window.debugTeamtools&&(window.debugTeamtools.all||window.debugTeamtools.xhr)&&console.log(text)},this.init=function(url){xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),xhr.open("POST",url,!0),xhr.setRequestHeader("Content-type","application/json"),xhr.onload=function(e){this.log("onload")}.bind(this),xhr.onloadstart=function(e){this.log("onloadstart")}.bind(this),xhr.onloadend=function(e){this.log("onloadend");var resp=e.target,error=null,data=JSON.parse(resp.response);200!=resp.status&&(error=data),callback(error,data)}.bind(this)},this.send=function(data){return xhr?void xhr.send(JSON.stringify(data)):void this.log("Not inited")},this.init(url)}function funcQueue(){var queue=[];this.addFunction=function(arguments,fScope){queue.push({func:arguments.callee.bind(fScope),args:arguments})},this.getLength=function(){return queue.length},this.execOne=function(index){var one=queue.pop();one.func.apply(null,one.args)},this.execAll=function(delay){for(var i in queue){var func=queue[i].func,args=queue[i].args;func.apply(null,args)}queue.splice(0,queue.length)}}window.debugTeamtools={},window.debugTeamtools.all=!0,window.debugTeamtools.xhr=!0,window.debugTeamtools.arguments=!0,window.teamtools=function(){var teamtools={},queue=new funcQueue,preInited=!1,inited=!1,access_token="",refresh_token="",endUser="",key="",checkArguments=function(arguments,count,callback){if(callback="undefined"!=typeof callback?callback:!0,arguments.length<count){var error=new Error("Missing some arguments, expected "+count+" received "+arguments.length);throw error}if(callback&&"function"!=typeof arguments[count-1]){var error=new Error("Argument on position "+count+" should be function");throw error}},checkInited=function(){return inited&&""!=access_token?!0:!1},send=function(url,data,callback){checkArguments(arguments,3);var ajax=new ajaxWrapper(url,function(error,responseData){return error?void("access_denied"==error.error&&refreshToken(url,data,callback)):void callback(error,responseData)});data.access_token=access_token,ajax.send(data)},refreshToken=function(url,data,callback){var refreshTokenData={grant_type:"refresh_token",refresh_token:refresh_token},ajax=new ajaxWrapper("http://auth.teamtools.local/access_token",function(error,responseData){return error?void console.log("TOKEN: FATAL ERROR"):(access_token=responseData.access_token,refresh_token=responseData.refresh_token,void send(url,data,callback))});ajax.send(refreshTokenData)};return teamtools.init=function(accessToken,refreshToken,end_user,key_init){return checkInited()?void console.error("Teamtools is allready initialised"):preInited?void console.error("There is no need to call init method more than once"):(preInited=!0,access_token=accessToken,refresh_token=refreshToken,endUser=end_user,key=key_init,inited=!0,void queue.execAll())},teamtools.track=function(eventName,value){if(!checkInited())return void queue.addFunction(arguments,this);checkArguments(arguments,1,!1);var data={name:eventName,endUser:endUser,key:key};value&&(data.metadata=value),send("http://api.teamtools.local/events",data,function(error,response){return console.log(arguments),error?void console.error(error):void(1!=response.returnCode&&console.log(response.message))})},window.teamtools=teamtools,teamtools}(),teamtools.Gateway=function(name,link,initFunction){if(window[name])initFunction();else{var scriptGateway=document.createElement("script");scriptGateway.setAttribute("type","text/javascript"),scriptGateway.setAttribute("src",link),scriptGateway.onload=initFunction,document.body.appendChild(scriptGateway)}},teamtools.initStripe=function(apiKey){this.gateway=new teamtools.Stripe(apiKey)},teamtools.Stripe=function(apiKey){this.ready=!1,this.queue=new funcQueue,teamtools.Gateway.call(this,"Stripe","https://js.stripe.com/v2/",function(){window.Stripe.setPublishableKey(apiKey),this.ready=!0,this.queue.execAll()}.bind(this))},teamtools.Stripe.prototype.cardType=function(cardNumber){return window.Stripe.cardType(cardNumber)},teamtools.Stripe.prototype.validateCVC=function(cvc){return window.Stripe.card.validateCVC(cvc)},teamtools.Stripe.prototype.validateCardNumber=function(cardNumber){return window.Stripe.card.validateCardNumber(cardNumber)},teamtools.Stripe.prototype.validateExpiry=function(date){return window.Stripe.card.validateExpiry(date)},teamtools.Stripe.prototype.createToken=function(ccObject,callback){return this.ready?window.Stripe.card.createToken(ccObject,function(status,response){return 200!=status?void callback(response.error):void callback(null,response.id)}):void this.queue.addFunction(arguments,this)},teamtools.initBraintree=function(apiKey){this.gateway=new teamtools.Braintree(apiKey)},teamtools.Braintree=function(apiKey){this.ready=!1,this.queue=new funcQueue,teamtools.Gateway.call(this,"braintree","https://js.braintreegateway.com/v2/braintree.js",function(){this.client=new window.braintree.api.Client({clientToken:apiKey}),this.ready=!0,this.queue.execAll()}.bind(this))},teamtools.Braintree.prototype.createToken=function(ccObject,callback){return ccObject.expirationMonth=ccObject.exp_month,ccObject.expirationYear=ccObject.exp_year,ccObject.cvv=ccObject.cvc,ccObject.cardholderName=ccObject.name,ccObject.address_zip&&(ccObject.billingAddress={postalCode:ccObject.address_zip}),delete ccObject.cvc,delete ccObject.exp_month,delete ccObject.exp_year,delete ccObject.name,delete ccObject.address_zip,this.ready?this.client.tokenizeCard(ccObject,callback):void this.queue.addFunction(arguments,this)};